{% extends "bootstrap/base.html" %}
{% block title %}
	Data
{% endblock %}
{% block styles %}
	{{super()}}
	<link rel="stylesheet" href="{{url_for('static', filename='dashboard.css')}}">
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
{% endblock %}
{% block content %}
	{% include 'includes/_navbar_top.html' %}
    {% include 'includes/_messages.html' %}
    <div class="col-md-12">
        {#			<h1 class="page-header">Table: {{ dataset_info.name }}</h1>#}
        <form method=post>
            <table id="user_table" class="display" cellspacing="0"
                   width="100%">
                <thead>
                <tr>
                    <th></th>
                    {% for cname in cnames %}
                        <th>{{ cname[0] }}</th>
                    {% endfor %}
                </tr>
                </thead>
                <tbody></tbody>
            </table>
	        <a class="btn btn-lg btn-success pull-left project-action" href="{{ url_for(request.endpoint, dataset=dataset_info.id) }}">View Table info</a>
	        <a class="btn btn-lg btn-info pull-left project-action" href="{{ url_for('view_bp.history', dataset=dataset_info.id) }}">View History</a>
	        <input onclick="this.form.action='{{ url_for(request.endpoint, dataset=dataset_info.id, raw=True, delete_selection=True) }}'; this.form.submit()" class="btn btn-lg btn-warning pull-left project-action" type="button" value="Delete Selection" />
	        <input id="btn" class="btn btn-lg btn-danger pull-left project-action" type="button" value="Delete rows" />
        </form>
    </div>

    	<!-- Modal -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-body">
				<form method="post" action="{{ url_for(request.endpoint, dataset=dataset_info.id, raw=True, delete=True) }}">
					<table id="join_table" class="table table-striped table-bordered" width="100%">
                    <thead>
                    <tr>
                        <th>Column</th>
	                    <th>Operator</th>
	                    <th>Condition</th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <select class="form-control" name="column">
	                                {% for cname in cnames %}
                                        <option>{{ cname[0] }}</option>
	                                {% endfor %}
                                </select>
                            </td>
	                        <td>
	                            <select class="form-control" name="operator">
		                            <option>=</option>
		                            <option>></option>
		                            <option><</option>
		                            <option>CONTAINS</option>
		                            <option>AND</option>
		                            <option>OR</option>
		                            <option>NOT</option>
	                            </select>
                            </td>
                            <td>
	                            {{ delete_form.hidden_tag() }}
	                            {{ delete_form.condition(class_="form-control typeahead",  autocomplete="off") }}
                            </td>
                        </tr>
                    </tbody>

                </table>
                <button type="submit" class="btn btn-success">Submit</button>
				</form>
				</div>

			</div>
		</div>
	</div>
{% endblock %}

{% block scripts %}
	{{ super() }}
	<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" charset="utf-8">
		$(document).ready(function (){
		    $('#btn').click(function () {
		        $('#myModal').modal('show');
		    });
		});
	</script>

	<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" charset="utf-8">
		$(document).ready(function (){
		    var table = $('#user_table').DataTable({
                'sDom': '<"H"lpr>t<i"F">',
			    'processing': true,
			    'serverSide': true,
			    'ajax': "{{ url_for('view_bp.retrieve', sql_table_name=dataset_info.working_copy) }}",
			    'columnDefs': [{
			        'targets': 0,
				    'searchable': false,
				    'orderable': false,
				    'className': 'dt-body-center',
				    'render': function (data, type, full, meta){
			            return '<input type="checkbox" name="data_id[]" value="' + $('<div/>').text(data).html() + '">';
			        }
			    }],
			    'order': [[1, 'asc']]
		    });
		});
	</script>
{% endblock %}
